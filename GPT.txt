

TÃNH NÄ‚NG 1 â€” Tá»° QUAY tráº­n Ä‘áº¥u & trigger highlight (báº±ng voice hoáº·c nÃºt)
Váº¥n Ä‘á» anh Ä‘ang gáº·p:
KhÃ³ thiáº¿t káº¿ UI: vá»«a quay video toÃ n tráº­n, vá»«a báº¯t highlight báº±ng voice hoáº·c nÃºt mÃ  khÃ´ng lÃ m ngÆ°á»i chÆ¡i bá»‹ rá»‘i.


KhÃ³ xá»­ lÃ½ logic: liÃªn tá»¥c cáº¯t clip 30â€“60 giÃ¢y trÆ°á»›c má»—i láº§n cÃ³ trigger mÃ  khÃ´ng lag, khÃ´ng tá»‘n bá»™ nhá»›.


TÃ´i Ä‘Æ°a ra luá»“ng giáº£i phÃ¡p tá»‘i Æ°u nháº¥t:

ğŸ§  Kiáº¿n trÃºc xá»­ lÃ½ video Ä‘Ãºng chuáº©n (giÃºp app mÆ°á»£t)
App khÃ´ng Ä‘Æ°á»£c cáº¯t clip ngay lÃºc ngÆ°á»i dÃ¹ng báº¥m hoáº·c nÃ³i â€œhighlightâ€.
 LÃ½ do:
Cáº¯t video trá»±c tiáº¿p trÃªn mobile â†’ Ä‘á»©ng app â†’ CPU nÃ³ng â†’ dropout frame â†’ crash sau 20â€“40 phÃºt quay.


CÃ¡ch Ä‘Ãºng:
Quay suá»‘t tráº­n Ä‘áº¥u = buffer 1 video duy nháº¥t (1 file)
 Highlight = metadata bookmark, khÃ´ng rá» vÃ o video ngay lÃºc báº¥m
ğŸ“Œ Khi user nÃ³i keyword â€œhighlightâ€ â†’ event: {timestamp = 17:22:14}
ğŸ“Œ Khi user nháº¥n nÃºt â€œLÆ°u highlightâ€ â†’ event: {timestamp = 24:01:08}

ToÃ n bá»™ sá»± kiá»‡n Ä‘Æ°á»£c ghi láº¡i dÆ°á»›i dáº¡ng danh sÃ¡ch highlight events.
ğŸ‘‰ Sau khi tráº­n káº¿t thÃºc â†’ backend chá»‰ viá»‡c:
má»Ÿ file video full


cáº¯t láº¡i tá»«ng Ä‘oáº¡n dá»±a trÃªn timestamps


30â€“60 giÃ¢y backward má»—i event


xuáº¥t thÃ nh cÃ¡c video highlight hoÃ n chá»‰nh


â†’ App luÃ´n mÆ°á»£t
 â†’ KhÃ´ng tiÃªu tá»‘n tÃ i nguyÃªn lÃºc Ä‘ang quay

ğŸ¨ UI/UX â€” Giao diá»‡n Ä‘áº¹p vÃ  dá»… dÃ¹ng
MÃ n hÃ¬nh quay tráº­n (cháº¿ Ä‘á»™ camera)
UI chá»‰ cÃ³ 2 hÃ nh Ä‘á»™ng lá»›n â€” khÃ´ng phÃ¢n tÃ¡n ngÆ°á»i dÃ¹ng
ğŸ”˜ NÃºt â€œLÆ°u highlightâ€ (tap má»™t láº§n)


ğŸ¤ Mic hiá»ƒn thá»‹ tráº¡ng thÃ¡i â€œvoice highlight ONâ€


KhÃ´ng Ä‘á»ƒ nhiá»u nÃºt, khÃ´ng cÃ³ thanh cÃ´ng cá»¥, khÃ´ng cho filter khi Ä‘ang quay.
Sáº¯c mÃ u
NÃºt Highlight = Ä‘á» / ná»•i báº­t


Info nhá» gÃ³c pháº£i: â€œHighlight Ä‘Ã£ lÆ°u â€¢ 12sâ€ (fade sau 1s)


TÃ¢m lÃ½ ngÆ°á»i chÆ¡i
 Há» muá»‘n chÆ¡i, khÃ´ng muá»‘n â€œÄ‘iá»u khiá»ƒn appâ€.
 UI pháº£i 100% táº­p trung vÃ o viá»‡c: â€œ1 cháº¡m hoáº·c 1 cÃ¢u nÃ³i lÃ  xongâ€
MÃ n hÃ¬nh review sau tráº­n
Hiá»ƒn thá»‹ dáº¡ng danh sÃ¡ch tháº» video:
VÃ­ dá»¥:
Highlight 1 â€“ 35 giÃ¢y (timestamp 07:20)
Highlight 2 â€“ 41 giÃ¢y (timestamp 13:54)
Highlight 3 â€“ 48 giÃ¢y (timestamp 23:10)

Má»—i tháº» cÃ³:
Play


Edit (cáº¯t + thÃªm text + hiá»‡u á»©ng)


Add to compilation (Ä‘Æ°a vÃ o video highlight cuá»‘i)


Cuá»‘i cÃ¹ng: 1 nÃºt â€œTáº¡o video highlight hoÃ n chá»‰nhâ€
 â†’ Render video tá»•ng â†’ share / download

âš™ï¸ CÃ´ng nghá»‡ phÃ¹ há»£p nháº¥t cho tÃ­nh nÄƒng nÃ y
Video quay: 1 file duy nháº¥t (.mp4 / h.264 / 1080p hoáº·c 720p)


LÆ°u buffer timestamp trong SQLite hoáº·c local JSON


Voice trigger: dÃ¹ng offline speech keyword detector â†’ khÃ´ng cáº§n internet â†’ nhanh â†’ khÃ´ng tá»‘n pin


Ká»¹ thuáº­t phÃ¹ há»£p: Porcupine / Vosk / Whisper tiny offline


Sau tráº­n: upload video + metadata â†’ backend cáº¯t highlight báº±ng FFmpeg (nhanh, ráº», khÃ´ng GPU)


FFmpeg command máº«u
ffmpeg -i fullmatch.mp4 -ss (timestamp - 00:00:45) -t 60 highlight1.mp4

â†’ siÃªu ráº», siÃªu nhanh, khÃ´ng cáº§n AI á»Ÿ step nÃ y.

âš« TÃNH NÄ‚NG 2 â€” QuÃ©t QR táº¡i sÃ¢n â†’ camera sÃ¢n báº­t â†’ AI highlight tá»± Ä‘á»™ng
Váº¥n Ä‘á» anh káº¹t:
Luá»“ng ngÆ°á»i dÃ¹ng: thanh toÃ¡n xong, camera sao tá»± báº­t?


CÃ´ng nghá»‡: káº¿t ná»‘i giá»¯a app vá»›i camera ngoÃ i sÃ¢n nhÆ° tháº¿ nÃ o?


TÃ´i cho anh cáº¥u trÃºc Ä‘Ãºng, Ä‘Ã£ chá»©ng minh lÃ  triá»ƒn khai Ä‘Æ°á»£c:

ğŸ§© Luá»“ng xá»­ lÃ½ chÃ­nh xÃ¡c (B2B2C)
1ï¸âƒ£ NgÆ°á»i dÃ¹ng quÃ©t mÃ£ QR â†’ app nháº­n Court_ID
 2ï¸âƒ£ NgÆ°á»i dÃ¹ng chá»n gÃ³i â†’ thanh toÃ¡n â†’ backend nháº­n OK
 3ï¸âƒ£ Backend gá»­i command tá»›i Camera_agent táº¡i sÃ¢n
 4ï¸âƒ£ Camera_agent báº¯t Ä‘áº§u stream/record â†’ upload Ä‘áº¿n storage
 5ï¸âƒ£ Káº¿t thÃºc giá» â†’ Camera_agent dá»«ng record
 6ï¸âƒ£ Video full Ä‘Æ°á»£c gá»­i sang Video_processing_service
 7ï¸âƒ£ AI highlight tá»± Ä‘á»™ng â†’ gá»™p clip â†’ gá»­i vá» app ngÆ°á»i dÃ¹ng
â† ngÆ°á»i dÃ¹ng háº§u nhÆ° khÃ´ng pháº£i thao tÃ¡c gÃ¬ ngoÃ i quÃ©t QR vÃ  thanh toÃ¡n.

ğŸ”Œ Camera agent â€” chÃ¬a khÃ³a Ä‘á»ƒ há»‡ thá»‘ng cháº¡y Ä‘Æ°á»£c
Camera á»Ÿ sÃ¢n khÃ´ng Ä‘Æ°á»£c Ä‘iá»u khiá»ƒn trá»±c tiáº¿p tá»« app.
 CÃ¡ch Ä‘Ãºng:
Má»—i camera cháº¡y 1 dá»‹ch vá»¥ nhá» gá»i lÃ  camera agent (Raspberry Pi / mini PC / Android box)


Agent káº¿t ná»‘i 1 chiá»u tá»›i backend (websocket hoáº·c polling)


Backend gá»­i lá»‡nh â€œstart / stopâ€ lÃ  Ä‘á»§


ÄÃ¢y lÃ  nÆ¡i má»i startup sports-tech Ä‘á»u lÃ m sai:
 âŒ cá»‘ Ä‘iá»u khiá»ƒn camera trá»±c tiáº¿p tá»« app â†’ NAT/IP/firewall vá»¡ máº·t
 âœ” Ä‘Ãºng lÃ : agent cÃ i trong sÃ¢n, nghe lá»‡nh tá»« server

ğŸ” AI highlight cho cháº¿ Ä‘á»™ QR táº¡i sÃ¢n
á» mÃ´ hÃ¬nh quÃ©t QR, khÃ´ng cÃ³ nÃºt/voice trigger â†’ pháº£i cÃ³ AI tracking.
Luá»“ng gá»n nháº¥t vÃ  ráº» nháº¥t:
Tá»± Ä‘á»™ng tÄƒng Ä‘iá»ƒm cho cÃ¡c Ä‘oáº¡n cÃ³:


motion cao liÃªn tá»¥c (rally)


audio peak


vá»‹ trÃ­ bÃ³ng & ngÆ°á»i trong vÃ¹ng court


Chá»n top N Ä‘oáº¡n


Xuáº¥t highlight 1â€“2 phÃºt + 3 video dá»c


â†’ MVP Ä‘áº¹p â€” chÆ°a cáº§n deep learning phá»©c táº¡p
 â†’ KhÃ´ng tiÃªu GPU náº·ng
Khi scale tÄƒng:
Thay heuristic báº±ng model action recognition Ä‘á»ƒ tracking tÃ¬nh huá»‘ng Ä‘iá»ƒm tháº¯ng / pha khÃ³ / smash


1. Kiáº¿n trÃºc tá»•ng thá»ƒ há»‡ thá»‘ng (á»Ÿ má»©c â€œdev cáº§m lÃ m Ä‘Æ°á»£câ€)
CÃ¡c khá»‘i chÃ­nh:
Client (React)


App quay video (tá»± quay)


App quÃ©t QR, xem & quáº£n lÃ½ highlight


API Server (Node/Nest/Express gÃ¬ cÅ©ng Ä‘Æ°á»£c)


Auth, session, payment, quáº£n lÃ½ sÃ¢n, quáº£n lÃ½ camera


Táº¡o/nhiá»‡m vá»¥ â€œhighlight_jobâ€


Media & AI Service (microservice riÃªng hoáº·c module trong backend)


Nháº­n video full


DÃ¹ng FFmpeg + AI/heuristic Ä‘á»ƒ cáº¯t highlight


GhÃ©p thÃ nh video tá»•ng


Storage


S3 / GCS / Wasabiâ€¦ lÆ°u:


Video full tráº­n


CÃ¡c highlight clip


Final highlight


Edge Agent táº¡i sÃ¢n (ráº¥t quan trá»ng cho IP cam)


Cháº¡y á»Ÿ sÃ¢n (mini PC/Raspberry Pi/box)


Äá»c stream tá»« IP cam (RTSP/ONVIF)


Nháº­n lá»‡nh tá»« server (start/stop)


Gá»­i stream hoáº·c file lÃªn cloud



2. TÃNH NÄ‚NG 1 â€“ Tá»° QUAY + Báº®T HIGHLIGHT (VOICE / NÃšT)
2.1. Luá»“ng user (UX flow)
MÃ n hÃ¬nh 1: Chá»n cháº¿ Ä‘á»™ quay
NÃºt: Start Self Recording


Chá»n:


MÃ´n: Pickleball / â€¦


Thá»i lÆ°á»£ng dá»± kiáº¿n (vd: 60 phÃºt) â€“ dÃ¹ng Ä‘á»ƒ gá»£i Ã½, khÃ´ng báº¯t buá»™c chÃ­nh xÃ¡c


Nháº¥n â€œBáº¯t Ä‘áº§uâ€ â†’ chuyá»ƒn sang mÃ n hÃ¬nh camera.

MÃ n hÃ¬nh 2: MÃ n hÃ¬nh quay tráº­n
Layout Ä‘á» xuáº¥t:
View full mÃ n hÃ¬nh: preview camera


Overlay trÃªn video:


GÃ³c trÃ¡i trÃªn: thá»i gian quay (00:12:35)


GÃ³c pháº£i trÃªn: tráº¡ng thÃ¡i mic (icon ğŸ¤ on/off)


GÃ³c dÆ°á»›i giá»¯a:


NÃºt trÃ²n to â€œLÆ°u Highlightâ€


NÃºt nhá» â€œKáº¿t thÃºc tráº­nâ€


HÃ nh vi:
NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ:


Báº¥m â€œLÆ°u Highlightâ€ báº¥t ká»³ lÃºc nÃ o


Hoáº·c nÃ³i tá»« khÃ³a â€œhighlightâ€ (náº¿u báº­t Voice trigger)


Khi trigger:


Hiá»ƒn thá»‹ toast: âœ… Highlight saved (00:13:54) trong 1â€“2s


Khi nháº¥n â€œKáº¿t thÃºc tráº­nâ€:


Dá»«ng quay


Hiá»ƒn thá»‹ mÃ n hÃ¬nh â€œÄang upload video & xá»­ lÃ½ highlightâ€¦â€



MÃ n hÃ¬nh 3: Danh sÃ¡ch highlight sau tráº­n
Sau khi backend xá»­ lÃ½ xong:
Danh sÃ¡ch dáº¡ng card:


Thumbnail


Thá»i lÆ°á»£ng: 42s


Label: â€œHighlight #1 â€“ Rally dÃ i bÃªn trÃ¡i sÃ¢nâ€ (anh cÃ³ thá»ƒ auto Ä‘áº·t tÃªn hoáº·c Ä‘á»ƒ generic)


Vá»›i má»—i highlight:


Xem


Chá»‰nh sá»­a (trim, thÃªm text, filter Ä‘Æ¡n giáº£n)


ThÃªm vÃ o video tá»•ng


Cuá»‘i cÃ¹ng cÃ³ nÃºt:
Táº¡o video highlight hoÃ n chá»‰nh â†’ backend ghÃ©p cÃ¡c clip Ä‘Æ°á»£c chá»n



2.2. CÃ¡ch xá»­ lÃ½ trÃªn client (React)
Quan trá»ng: khÃ´ng Ä‘Æ°á»£c cáº¯t video khi Ä‘ang quay.
TrÃªn client anh lÃ m:
state = {
  isRecording: false,
  recordingStartTime: Date.now(),
  highlightEvents: [ timestampInMs, ... ], // list cÃ¡c má»‘c highlight
};

Khi báº¯t Ä‘áº§u quay:


Gá»i getUserMedia (web) hoáº·c lib camera (náº¿u dÃ¹ng React Native), báº¯t Ä‘áº§u quay 1 file duy nháº¥t.


Khi user:


Báº¥m nÃºt â€œLÆ°u Highlightâ€ â†’ push Date.now() vÃ o highlightEvents


NÃ³i â€œhighlightâ€ â†’ module nháº­n diá»‡n tá»« khÃ³a, cÅ©ng push timestamp vÃ o highlightEvents


Khi káº¿t thÃºc:


Dá»«ng quay â†’ cÃ³ file full_match.mp4


Upload file nÃ y lÃªn storage (qua backend hoáº·c trá»±c tiáº¿p S3 + láº¥y video_url)


Gá»­i request tá»›i backend:


POST /api/sessions/self-record/finish
{
  "session_id": "abc123",
  "video_url": "https://s3.../full_match.mp4",
  "recording_start_time": "2025-11-29T10:00:00Z",
  "highlight_events": [
    "2025-11-29T10:12:34Z",
    "2025-11-29T10:21:05Z",
    ...
  ]
}

Backend lo pháº§n cÃ²n láº¡i.

2.3. Voice trigger (React)
Náº¿u lÃ  web app:
DÃ¹ng: Web Speech API (SpeechRecognition)


Listen continuous


Khi detect â€œhighlightâ€ trong transcript â†’ táº¡o highlight event.


Náº¿u lÃ  React Native:
DÃ¹ng lib nhÆ° react-native-voice hoáº·c tÃ­ch há»£p Vosk/Whisper tiny qua native


Hoáº·c phiÃªn báº£n V1: chá»‰ cÃ³ nÃºt â€œLÆ°u Highlightâ€, voice Ä‘á»ƒ phase 2 â€“ product váº«n dÃ¹ng ngon.



2.4. Xá»­ lÃ½ backend cho Self Record
Model dá»¯ liá»‡u Session
Session {
  id: string;
  user_id: string;
  type: "SELF_RECORD" | "COURT_CAMERA";
  start_time: Date;
  end_time: Date;
  video_url: string;        // video full tráº­n
  status: "PROCESSING" | "DONE" | "FAILED";
}

Báº£ng HighlightEvents
HighlightEvent {
  id: string;
  session_id: string;
  event_time: Date;        // timestamp tuyá»‡t Ä‘á»‘i
}

Báº£ng HighlightClip
HighlightClip {
  id: string;
  session_id: string;
  start_offset_sec: number; // giÃ¢y tÃ­nh tá»« Ä‘áº§u video full
  duration_sec: number;
  clip_url: string;
}

Job xá»­ lÃ½ (worker)
Pseudo logic:
for each HighlightEvent in session:
    offset = event_time - session.start_time  // giÃ¢y
    clip_start = max(offset - 45, 0)
    duration = 45 or 60

    ffmpeg(
      input = session.video_url,
      ss = clip_start,
      t = duration,
      output = new_clip_url
    )

    save HighlightClip

Sau Ä‘Ã³:
Náº¿u user yÃªu cáº§u â€œvideo tá»•ngâ€:


Láº¥y danh sÃ¡ch clip user chá»n


Táº¡o file concat_list.txt rá»“i dÃ¹ng ffmpeg concat filter


ffmpeg -f concat -safe 0 -i concat_list.txt -c copy final_highlight.mp4

â†’ Ráº¥t ráº», cháº¡y Ä‘Æ°á»£c trÃªn server CPU bÃ¬nh thÆ°á»ng (EC2 táº§m trung lÃ  Ä‘á»§).

3. TÃNH NÄ‚NG 2 â€“ QUÃ‰T QR Táº I SÃ‚N + IP CAM + AI HIGHLIGHT
3.1. Luá»“ng user (UX)
Step 1 â€“ QuÃ©t QR
QR dÃ¡n á»Ÿ sÃ¢n:
my2light.com/court/{COURT_ID}

User:
QuÃ©t báº±ng camera â†’ má»Ÿ app/web my2light


App gá»i GET /api/courts/{COURT_ID} Ä‘á»ƒ:


Hiá»ƒn thá»‹ tÃªn sÃ¢n, giÃ¡ gÃ³i, thá»i lÆ°á»£ng


Step 2 â€“ Thanh toÃ¡n
User chá»n:


GÃ³i: 60/90 phÃºt


Sá»‘ ngÆ°á»i share chi phÃ­ (optional)


Nháº¥n â€œThanh toÃ¡nâ€ â†’ redirect qua Momo/VNPay/Stripe.
Khi thanh toÃ¡n xong:
Backend nháº­n webhook PAYMENT_SUCCESS cho session_id


Backend:


Cáº­p nháº­t session status = PAID


Gá»­i lá»‡nh tá»›i Edge Agent cá»§a sÃ¢n: START_RECORDING(session_id, duration)


Step 3 â€“ Camera sÃ¢n tá»± quay
Edge Agent:


Káº¿t ná»‘i vá»›i IP cam (RTSP)


Hoáº·c:


Push RTMP lÃªn server stream


Hoáº·c ghi file local rá»“i upload chunk/1 file sau khi káº¿t thÃºc


Háº¿t thá»i lÆ°á»£ng:


Dá»«ng quay


Upload video full


Gá»­i callback RECORDING_DONE(session_id, video_url) vá» backend


Step 4 â€“ Backend xá»­ lÃ½ AI highlight
Nháº­n video_url â†’ táº¡o job AI highlight:


Heuristic: motion + audio


Hoáº·c action recognition khi vá» sau cÃ³ data


Táº¡o nhiá»u HighlightClip giá»‘ng nhÆ° self-record nhÆ°ng khÃ´ng cáº§n HighlightEvent (AI tá»± chá»n event)


Khi xong:


Gá»­i push/email/in-app: â€œHighlight tráº­n cá»§a báº¡n táº¡i sÃ¢n X Ä‘Ã£ sáºµn sÃ ngâ€


User vÃ o app â†’ xem & táº£i.



3.2. Kiáº¿n trÃºc ká»¹ thuáº­t cho IP cam + Edge Agent
Do anh dÃ¹ng IP cam chuyÃªn dá»¥ng, Ä‘a sá»‘ há»— trá»£:
RTSP stream (vd: rtsp://user:pass@ip:port/stream1)


ONVIF (Ä‘á»ƒ Ä‘iá»u khiá»ƒn)


Edge Agent (á»Ÿ sÃ¢n):
CÃ³ thá»ƒ dÃ¹ng:


1 con mini PC (Intel NUC) hoáº·c


Raspberry Pi 4 náº¿u bitrate khÃ´ng quÃ¡ cao


Software:


Service Node/Python cháº¡y:


WebSocket client káº¿t ná»‘i backend: wss://api.my2light.com/agents/{AGENT_ID}


Module FFmpeg/LibVLC Ä‘á»ƒ:


start record: ffmpeg -i rtsp://... -c copy file.mp4


hoáº·c push RTMP: ffmpeg -i rtsp://... -c copy -f flv rtmp://stream.my2light.com/live/session_id


Backend â€“ Agent Protocol (giáº£n lÆ°á»£c)
Khi payment xong:


WS message to agent:
{
  "type": "START_RECORDING",
  "session_id": "sess_123",
  "court_id": "court_abc",
  "duration_sec": 3600
}

Agent tráº£ lá»i:


{
  "type": "RECORDING_STARTED",
  "session_id": "sess_123",
  "started_at": "..."
}

Sau khi quay xong & upload:


{
  "type": "RECORDING_DONE",
  "session_id": "sess_123",
  "video_url": "https://s3.../sess_123_full.mp4"
}

Backend nháº­n video_url â†’ Ä‘áº©y vÃ o pipeline AI highlight giá»‘ng self-record (nhÆ°ng event do AI xÃ¡c Ä‘á»‹nh).

3.3. AI highlight cho cháº¿ Ä‘á»™ sÃ¢n (khÃ´ng cÃ³ nÃºt/voice)
MVP (chi phÃ­ tháº¥p):
Heuristic:


Downscale video â†’ 720p


TÃ­nh frame difference / optical flow â†’ cháº¥m motion_score


TÃ­nh audio peak â†’ audio_score


Äáº·t threshold Ä‘á»ƒ xÃ¡c Ä‘á»‹nh â€œkhoáº£ng rallyâ€


Sau Ä‘Ã³:


Gom cÃ¡c segment liÃªn tiáº¿p cÃ³ score cao thÃ nh 1 highlight


Láº¥y top N segment theo â€œÄ‘á»™ dÃ i rally + audio peakâ€


Cáº¯t thÃ nh clip báº±ng FFmpeg


Output:


1 video tá»•ng (1â€“2 phÃºt) + 3â€“5 video dá»c


Phase sau (nÃ¢ng cháº¥t lÆ°á»£ng):
Thu tháº­p data tá»« ngÆ°á»i dÃ¹ng:


Há»i â€œHighlight nÃ y cÃ³ hay khÃ´ng?â€ â†’ feedback


Train model action recognition riÃªng cho pickleball


Dáº§n dáº§n thay heuristic báº±ng model â†’ highlight chÃ­nh xÃ¡c hÆ¡n



4. TÃ³m láº¡i cho 2 váº¥n Ä‘á» anh Ä‘ang káº¹t
Tá»± quay + highlight (Voice/NÃºt)
Giáº£i UX:


MÃ n hÃ¬nh quay cá»±c Ä‘Æ¡n giáº£n: 1 nÃºt lÆ°u highlight + tráº¡ng thÃ¡i mic.


KhÃ´ng edit trong lÃºc quay, chá»‰ Ä‘áº·t bookmark.


Giáº£i tech:


Quay 1 file duy nháº¥t â†’ upload â†’ backend cáº¯t báº±ng timestamps + FFmpeg.


Voice trigger: Web Speech API / react-native-voice, hoáº·c phase 2 má»›i lÃ m.


QuÃ©t QR táº¡i sÃ¢n + IP cam + AI
Giáº£i flow:


QR â†’ Chá»n gÃ³i â†’ Thanh toÃ¡n â†’ Server dá»±ng session â†’ Gá»­i lá»‡nh cho Edge Agent â†’ Quay â†’ Upload â†’ AI xá»­ lÃ½ â†’ Gá»­i highlight cho user.


Giáº£i tech:


IP cam khÃ´ng nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i app, mÃ  vá»›i Edge Agent táº¡i sÃ¢n.


Backend lÃ  â€œnÃ£oâ€: quáº£n lÃ½ session, payment, lá»‡nh start/stop, xá»­ lÃ½ AI.
I. NguyÃªn táº¯c chung (web app, mobile-first, tá»‘i Æ°u performance)
Mobile-first:


Layout 1 cá»™t, háº¡n cháº¿ scroll ngang.


Má»i nÃºt hÃ nh Ä‘á»™ng chÃ­nh pháº£i dá»… báº¥m báº±ng ngÃ³n cÃ¡i (Ä‘Ã¡y mÃ n hÃ¬nh).


KhÃ´ng blocking UI:


Táº¥t cáº£ xá»­ lÃ½ náº·ng (cáº¯t video, AI) cháº¡y backend.


Front chá»‰ upload + gá»­i metadata â†’ hiá»ƒn thá»‹ tráº¡ng thÃ¡i chá».


Video:


Quay 1 file duy nháº¥t, khÃ´ng cáº¯t trÃªn client.


Upload dáº¡ng chunk (resumable) náº¿u tráº­n dÃ i.


Tráº¡ng thÃ¡i rÃµ rÃ ng:


Má»—i bÆ°á»›c cÃ³ state: idle / recording / uploading / processing / ready / failed.


NgÆ°á»i dÃ¹ng luÃ´n biáº¿t â€œÄ‘ang á»Ÿ Ä‘Ã¢u trong quy trÃ¬nhâ€.



II. UI/UX FLOW â€“ MOBILE WEB
A. Flow 1 â€“ Tá»± quay + báº¯t highlight (voice / nÃºt)
1. MÃ n hÃ¬nh Home / Dashboard
Má»¥c tiÃªu: cho user chá»n 2 cháº¿ Ä‘á»™:
â€œTá»± quayâ€


â€œQuÃ©t QR táº¡i sÃ¢nâ€


Layout (mobile):
Header: logo my2light, avatar nhá».


Section chÃ­nh:


[ Card 1 ]
ğŸ¥ Tá»± quay tráº­n Ä‘áº¥u cá»§a báº¡n
MÃ´ táº£: DÃ¹ng Ä‘iá»‡n thoáº¡i quay, báº¥m/nÃ³i "highlight" Ä‘á»ƒ lÆ°u pha hay
[ NÃºt: Báº¯t Ä‘áº§u tá»± quay ]

[ Card 2 ]
ğŸŸ QuÃ©t QR táº¡i sÃ¢n
MÃ´ táº£: QuÃ©t mÃ£ táº¡i sÃ¢n cÃ³ my2light, camera sÃ¢n sáº½ tá»± quay & lÃ m highlight
[ NÃºt: QuÃ©t QR ngay ]

Footer: tab nhá» â€œHighlight cá»§a tÃ´iâ€, â€œTÃ i khoáº£nâ€.



2. MÃ n hÃ¬nh â€œChuáº©n bá»‹ quayâ€
Khi user báº¥m â€œBáº¯t Ä‘áº§u tá»± quayâ€:
Step 1: Check permission:


Náº¿u chÆ°a cho phÃ©p camera/mic â†’ popup giáº£i thÃ­ch ngáº¯n:


 â€œmy2light cáº§n quyá»n sá»­ dá»¥ng camera & micro Ä‘á»ƒ quay tráº­n cá»§a báº¡n.â€



Step 2: Form ngáº¯n:


MÃ´n: [ Pickleball â–¼ ]
Thá»i lÆ°á»£ng dá»± kiáº¿n: [ 60 phÃºt â–¼ ] (chá»‰ Ä‘á»ƒ hiá»ƒn thá»‹, khÃ´ng báº¯t buá»™c)
Voice trigger: [âœ“] Báº­t lá»‡nh "highlight"
[ NÃºt: Báº¯t Ä‘áº§u quay ]


3. MÃ n hÃ¬nh quay (Self record)
ÄÃ¢y lÃ  mÃ n hÃ¬nh quan trá»ng nháº¥t. Äá» xuáº¥t layout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ Video Preview full mÃ n ] â”‚
â”‚                              â”‚
â”‚  (Overlay gÃ³c trÃ¡i trÃªn)     â”‚
â”‚  â— 00:13:45                  â”‚
â”‚                              â”‚
â”‚  (Overlay gÃ³c pháº£i trÃªn)     â”‚
â”‚  ğŸ¤ Voice: ON                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ Toast ná»•i khi lÆ°u highlight ]
âœ… Highlight saved (00:12:34)

(Thanh Ä‘Ã¡y mÃ n hÃ¬nh)
[ â—¼ Káº¿t thÃºc ]          [ â˜… LÆ°u highlight ]

HÃ nh vi:
â˜… LÆ°u highlight:


Gá»­i event local: highlightEvents.push(Date.now())


Hiá»‡n toast 1â€“2s.


Voice trigger (náº¿u báº­t):


UI nhá» á»Ÿ gÃ³c trÃªn: "Listening 'highlight'..."


Khi detect â†’ xá»­ lÃ½ nhÆ° LÆ°u highlight.


â—¼ Káº¿t thÃºc:


Dá»«ng quay.


Chuyá»ƒn sang mÃ n hÃ¬nh â€œXá»­ lÃ½ videoâ€.



4. MÃ n hÃ¬nh â€œÄang upload & xá»­ lÃ½â€
Sau khi user báº¥m Káº¿t thÃºc:
TiÃªu Ä‘á»: Äang xá»­ lÃ½ tráº­n cá»§a báº¡n...

[ Stepper 3 bÆ°á»›c ]
1. â†‘ Upload video tráº­n Ä‘áº¥u        [xong / Ä‘ang cháº¡y]
2. âš™ï¸ Táº¡o cÃ¡c highlight tá»« má»‘c báº¡n Ä‘Ã¡nh dáº¥u
3. ğŸ¬ Chuáº©n bá»‹ video highlight

[ Thanh tiáº¿n trÃ¬nh ] [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ-----] 65%

[ NÃºt phá»¥: Vá» trang chá»§ ]
(Nháº¯n ngÆ°á»i dÃ¹ng: Khi xong sáº½ cÃ³ thÃ´ng bÃ¡o & email)

KhÃ´ng báº¯t user chá» má»Ÿ app â†’ cho phÃ©p rá»i mÃ n hÃ¬nh, thÃ´ng bÃ¡o sau.



5. MÃ n hÃ¬nh danh sÃ¡ch highlight (self-record)
Khi xá»­ lÃ½ xong:
User Ä‘Æ°á»£c dáº«n tá»›i:


TiÃªu Ä‘á»: Highlight tráº­n ngÃ y 29/11

[ Card Highlight 1 ]
Thumbnail | Highlight #1 â€“ 42s
          | LÃºc 00:12:34 trong tráº­n
[ Xem ] [ Chá»‰nh sá»­a ] [ ThÃªm vÃ o video tá»•ng ]

[ Card Highlight 2 ]
...

[ NÃºt lá»›n Ä‘Ã¡y mÃ n hÃ¬nh ]
[ ğŸ¬ Táº¡o video highlight hoÃ n chá»‰nh ]


6. MÃ n hÃ¬nh chá»‰nh sá»­a & táº¡o video tá»•ng
Khi báº¥m Chá»‰nh sá»­a:


Cho phÃ©p trim start/end


ThÃªm caption Ä‘Æ¡n giáº£n, speed, filter nháº¹.


Khi báº¥m Táº¡o video highlight hoÃ n chá»‰nh:


Popup:


Chá»n thá»© tá»± highlight


Chá»n intro/outro (template)


XÃ¡c nháº­n â†’ gá»­i request backend build video final â†’ mÃ n hÃ¬nh tráº¡ng thÃ¡i + notify khi xong.



B. Flow 2 â€“ QuÃ©t QR táº¡i sÃ¢n (IP cam + AI highlight)
1. MÃ n â€œQuÃ©t QRâ€
TrÃªn mobile web, anh cÃ³ 2 cÃ¡ch:
CÃ¡ch 1: QR má»Ÿ URL dáº¡ng https://my2light.com/court/{COURT_ID}?ref=qrcode
 â†’ trÃ¬nh duyá»‡t má»Ÿ tháº³ng tá»›i trang sÃ¢n â†’ khÃ´ng cáº§n scan trong app.


CÃ¡ch 2: App cÃ³ mÃ n hÃ¬nh camera scan QR (náº¿u anh lÃ m PWA riÃªng).


ÄÆ¡n giáº£n nháº¥t: dÃ¹ng CÃ¡ch 1.
Khi QR má»Ÿ URL:
2. MÃ n hÃ¬nh â€œThÃ´ng tin sÃ¢n & gÃ³iâ€
ğŸŸ SÃ¢n Pickleball ABC - Quáº­n 7

Thá»i lÆ°á»£ng gá»£i Ã½: [ 60 phÃºt â–¼ ]

GiÃ¡ gÃ³i quay & highlight:
â€¢ 60 phÃºt: 180.000Ä‘
â€¢ 90 phÃºt: 240.000Ä‘

[Chá»n 60p] [Chá»n 90p]

Thanh toÃ¡n:
(TÃ­ch chá»n) Chia Ä‘á»u cho 4 ngÆ°á»i? (chá»‰ Ä‘á»ƒ gá»£i Ã½, khÃ´ng báº¯t buá»™c backend)

[ NÃºt lá»›n: Thanh toÃ¡n & báº¯t Ä‘áº§u quay ]


3. MÃ n hÃ¬nh thanh toÃ¡n
Redirect hoáº·c embed: VNPay / Momo / Stripe.


Sau khi thanh toÃ¡n xong:


Hiá»‡n mÃ n hÃ¬nh:


âœ… Thanh toÃ¡n thÃ nh cÃ´ng!

Camera táº¡i sÃ¢n Ä‘ang Ä‘Æ°á»£c báº­t vÃ  ghi hÃ¬nh tráº­n cá»§a báº¡n.

Tráº­n cá»§a báº¡n:
â€¢ SÃ¢n: ABC - Court #2
â€¢ Thá»i lÆ°á»£ng: 60 phÃºt
â€¢ Báº¯t Ä‘áº§u: 19:30

[ NÃºt: Quay vá» trang chá»§ ]
[ Link: Xem tráº¡ng thÃ¡i highlight ]

Backend Ä‘á»“ng thá»i gá»­i lá»‡nh tá»›i Agent.

4. MÃ n hÃ¬nh â€œTráº­n Ä‘ang Ä‘Æ°á»£c ghi hÃ¬nhâ€
Trong tab â€œHighlight cá»§a tÃ´iâ€, user tháº¥y:
Äang ghi hÃ¬nh...

Tráº­n ngÃ y 29/11 - SÃ¢n ABC
Tráº¡ng thÃ¡i: ğŸŸ¢ Äang quay (19:30 â€“ 20:30)
Sau khi káº¿t thÃºc, há»‡ thá»‘ng sáº½ tá»± táº¡o highlight vÃ  gá»­i cho báº¡n.

[ NÃºt: Xem chi tiáº¿t ]


5. MÃ n â€œHighlight tráº­n sÃ¢nâ€ (sau khi AI xá»­ lÃ½ xong)
Gáº§n giá»‘ng self-record nhÆ°ng chÃº thÃ­ch:
Tráº­n sÃ¢n ABC - 29/11

[ Card Highlight 1 ]
AI chá»n â€“ Rally dÃ i 28s
[ Xem ] [ Bá» chá»n khá»i video tá»•ng ] [ Táº£i xuá»‘ng ]

[ Card Highlight 2 ]
AI chá»n â€“ Pha káº¿t thÃºc tráº­n 18s

[ ğŸ¬ Táº¡o video highlight hoÃ n chá»‰nh ]

User cÃ³ thá»ƒ bá» bá»›t highlight AI Ä‘á» xuáº¥t trÆ°á»›c khi build video tá»•ng.

III. API SPEC â€“ CHO DEV BACKEND
Giáº£ sá»­ backend lÃ  REST JSON.
1. Auth (rÃºt gá»n)
POST /api/auth/login
Body:


{ "provider": "google", "id_token": "..." }

Response:


{
  "access_token": "jwt...",
  "user": {
    "id": "u_123",
    "name": "Tom",
    "email": "tom@example.com"
  }
}

(Chi tiáº¿t auth anh tuá»³ chá»n, khÃ´ng pháº£i trá»ng tÃ¢m feature.)

2. Model dá»¯ liá»‡u chÃ­nh
User
User {
  id: string;
  name: string;
  email: string;
  avatar_url?: string;
  created_at: Date;
}

Court
Court {
  id: string;
  name: string;
  location: string;
  sport_type: "PICKLEBALL" | "TENNIS" | ...;
  agent_id: string;          // agent táº¡i sÃ¢n
  pricing: {
    "60": number;           // giÃ¡ 60 phÃºt
    "90": number;           // giÃ¡ 90 phÃºt
  };
  active: boolean;
}

Agent (Edge Agent táº¡i sÃ¢n)
Agent {
  id: string;
  court_id: string;
  status: "ONLINE" | "OFFLINE";
  last_seen_at: Date;
  rtsp_url: string;         // stream IP cam
}

Session
Session {
  id: string;
  user_id: string;
  court_id?: string;             // null náº¿u self-record
  type: "SELF_RECORD" | "COURT_CAMERA";
  start_time: Date;
  end_time?: Date;
  duration_sec?: number;
  video_url?: string;            // full video
  status: "CREATED" | "RECORDING" | "UPLOADING" | "PROCESSING" | "READY" | "FAILED";
  source: "MOBILE" | "AGENT";
}

HighlightEvent (chá»‰ self-record)
HighlightEvent {
  id: string;
  session_id: string;
  event_time: Date;          // thá»i Ä‘iá»ƒm thá»±c táº¿
  created_at: Date;
}

HighlightClip (cáº£ 2 loáº¡i)
HighlightClip {
  id: string;
  session_id: string;
  start_offset_sec: number;    // giÃ¢y tá»« Ä‘áº§u video
  duration_sec: number;
  clip_url: string;
  selected_for_compilation: boolean;
  origin: "USER_EVENT" | "AI_DETECTED";
}


3. Self-record API
3.1. Táº¡o session self-record
POST /api/sessions/self-record/start
Auth: user


Body:


{
  "sport_type": "PICKLEBALL",
  "expected_duration_sec": 3600,
  "voice_trigger_enabled": true
}

Response:


{
  "session_id": "sess_self_123",
  "upload_url": "https://upload.my2light.com/... (optional, náº¿u dÃ¹ng pre-signed URL)"
}


3.2. Gá»­i highlight events (cÃ³ thá»ƒ batch hoáº·c realtime)
Option 1 â€“ realtime (simple):
POST /api/sessions/self-record/:session_id/events
{
  "events": [
    { "event_time": "2025-11-29T10:12:34Z" },
    { "event_time": "2025-11-29T10:21:05Z" }
  ]
}

Option 2:
 LÆ°u local, gá»­i 1 láº§n khi káº¿t thÃºc â€“ backend dá»… xá»­ lÃ½ hÆ¡n.

3.3. Káº¿t thÃºc session self-record
POST /api/sessions/self-record/:session_id/finish
Body:


{
  "video_url": "https://s3.../full_match.mp4",
  "recording_start_time": "2025-11-29T10:00:00Z",
  "highlight_events": [
    "2025-11-29T10:12:34Z",
    "2025-11-29T10:21:05Z"
  ]
}

Response:


{
  "session_id": "sess_self_123",
  "status": "PROCESSING"
}

Backend sau Ä‘Ã³ táº¡o job:
TÃ­nh offset_sec = event_time â€“ start_time


DÃ¹ng FFmpeg cáº¯t clip.


Táº¡o cÃ¡c HighlightClip.



3.4. Láº¥y danh sÃ¡ch highlight clip cá»§a session
GET /api/sessions/:session_id/highlights
Response:


{
  "session_id": "sess_self_123",
  "status": "READY",
  "clips": [
    {
      "id": "clip_1",
      "start_offset_sec": 540,
      "duration_sec": 45,
      "clip_url": "https://...",
      "origin": "USER_EVENT",
      "selected_for_compilation": true
    },
    ...
  ]
}


3.5. Cáº­p nháº­t lá»±a chá»n clip cho video tá»•ng
PATCH /api/sessions/:session_id/highlights/:clip_id
{
  "selected_for_compilation": true
}


3.6. Táº¡o video highlight tá»•ng há»£p
POST /api/sessions/:session_id/compilation
Body (optional):


Thá»© tá»± clip.


{
  "clip_ids": ["clip_3", "clip_1", "clip_2"]
}

Response:


{
  "session_id": "sess_self_123",
  "compilation_id": "comp_789",
  "status": "PROCESSING"
}

Sau khi xong:
GET /api/sessions/:session_id/compilation/:compilation_id
{
  "status": "READY",
  "video_url": "https://.../final_highlight.mp4"
}


4. Court + QR + Payment + Agent API
4.1. Láº¥y thÃ´ng tin sÃ¢n tá»« QR URL
GET /api/courts/:court_id
Response:


{
  "id": "court_abc",
  "name": "SÃ¢n Pickleball ABC",
  "location": "Quáº­n 7, TP.HCM",
  "sport_type": "PICKLEBALL",
  "pricing": {
    "60": 180000,
    "90": 240000
  },
  "agent_status": "ONLINE"
}


4.2. Táº¡o session court-camera trÆ°á»›c khi thanh toÃ¡n
POST /api/sessions/court-camera/start
{
  "court_id": "court_abc",
  "duration_sec": 3600
}

Response:


{
  "session_id": "sess_court_123",
  "payment_url": "https://pay.my2light.com/..."
}

Frontend redirect user tá»›i payment_url.

4.3. Webhook thanh toÃ¡n thÃ nh cÃ´ng (tá»« Momo/VNPayâ€¦)
POST /api/payments/webhook
Body (tuá»³ cá»•ng):


{
  "gateway": "momo",
  "transaction_id": "txn_123",
  "status": "SUCCESS",
  "session_id": "sess_court_123",
  "amount": 180000
}

Backend:
XÃ¡c nháº­n thanh toÃ¡n.


Set session status PAID.


Gá»­i lá»‡nh cho Agent:


{
  "type": "START_RECORDING",
  "session_id": "sess_court_123",
  "duration_sec": 3600
}


4.4. WebSocket protocol giá»¯a Backend & Agent
Káº¿t ná»‘i:
Agent connect tá»›i: wss://api.my2light.com/agents


Gá»­i message AUTH:


{
  "type": "AUTH",
  "agent_id": "agent_abc",
  "secret": "..." // token
}

Backend reply AUTH_OK, sau Ä‘Ã³ giá»¯ káº¿t ná»‘i.
Command tá»« Backend tá»›i Agent:
{
  "type": "START_RECORDING",
  "session_id": "sess_court_123",
  "rtsp_url": "rtsp://user:pass@ip/stream1",
  "duration_sec": 3600
}

Agent tráº£ lá»i:
Khi báº¯t Ä‘áº§u:


{
  "type": "RECORDING_STARTED",
  "session_id": "sess_court_123",
  "started_at": "2025-11-29T12:00:00Z"
}

Khi káº¿t thÃºc & upload xong:


{
  "type": "RECORDING_DONE",
  "session_id": "sess_court_123",
  "video_url": "https://s3.../sess_court_123_full.mp4",
  "duration_sec": 3590
}

Náº¿u lá»—i:


{
  "type": "RECORDING_FAILED",
  "session_id": "sess_court_123",
  "error": "RTSP_CONNECTION_ERROR"
}

Backend nháº­n video_url â†’ táº¡o job AI highlight tÆ°Æ¡ng tá»± self-record (nhÆ°ng tá»± detect event).

4.5. Láº¥y danh sÃ¡ch session cá»§a user
GET /api/sessions?user_id=me
Response:


{
  "sessions": [
    {
      "id": "sess_self_123",
      "type": "SELF_RECORD",
      "status": "READY",
      "created_at": "...",
      "source": "MOBILE"
    },
    {
      "id": "sess_court_123",
      "type": "COURT_CAMERA",
      "status": "PROCESSING",
      "created_at": "...",
      "court": {
        "id": "court_abc",
        "name": "SÃ¢n ABC"
      }
    }
  ]
}


IV. Má»™t vÃ i lÆ°u Ã½ performance & á»•n Ä‘á»‹nh
Self-record:


Giá»›i háº¡n quality quay: 720p @ 30fps lÃ  Ä‘á»§ cho mobile + social.


DÃ¹ng MediaRecorder vá»›i timeslice (chunk upload) náº¿u tráº­n quÃ¡ dÃ i.


Náº¿u máº¡ng yáº¿u: cho phÃ©p â€œtáº£i lÃªn sauâ€ khi cÃ³ wifi.


Court-camera:


Agent nÃªn ghi file local trÆ°á»›c, rá»“i upload sau, trÃ¡nh phá»¥ thuá»™c vÃ o máº¡ng realtime.


Náº¿u dÃ¹ng RTMP â†’ backend cÃ³ thá»ƒ vá»«a record vá»«a chuáº©n bá»‹ cho livestream (phase 2).


AI/Highlight:


MVP: heuristic + FFmpeg, khÃ´ng cáº§n GPU.


Tá»‘i Æ°u disk I/O: xá»­ lÃ½ tá»«ng file, xong lÃ  xoÃ¡ táº¡m.



